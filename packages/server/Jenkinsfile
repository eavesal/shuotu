pipeline{
    agent{
        label "nodejs"
    }

    environment {
        DOCKER_CREDENTIAL_ID = 'docker-hub'
        KUBECONFIG_CREDENTIAL_ID = 'kubeconfig'
        WORKING_SERVICE = 'server'
    }

    stages{
        stage ('Checkout') {
            steps {
                checkout(scm)
            }
        }

        stage("Install"){
            dir ("packages/${WORKING_SERVICE}") {
                steps {
                    container ('nodejs') {
                        sh 'yarn install'
                    }
                }
            }
        }

        stage("Build"){
            dir ("packages/${WORKING_SERVICE}") {
                steps {
                    container ('nodejs') {
                        sh 'yarn run build'
                    }
                }
            }
        }
    }
    post{
        always{
            echo "========always========"
        }
        success{
            echo "========pipeline executed successfully ========"
        }
        failure{
            echo "========pipeline execution failed========"
        }
    }
}
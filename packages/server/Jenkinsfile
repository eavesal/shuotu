pipeline{
    agent{
        label "nodejs"
    }

    environment {
        DOCKER_CREDENTIAL_ID = 'docker-hub'
        KUBECONFIG_CREDENTIAL_ID = 'kubeconfig'
        WORKING_SERVICE = 'server'
    }

    stages{
        stage ('Checkout') {
            steps {
                checkout(scm)
            }
        }

        stage ("Install") {
            steps {
                container ('nodejs') {
                    dir ("packages/${WORKING_SERVICE}") {
                        sh 'yarn install'
                    }
                }
            }
        }

        stage ("Build"){
            steps {
                container ('nodejs') {
                    dir ("packages/${WORKING_SERVICE}") {
                        sh 'yarn run build'
                    }       
                }
            }
        }
    }

    post{
        always{
            echo "========always========"
        }
        success{
            echo "========pipeline executed successfully ========"
        }
        failure{
            echo "========pipeline execution failed========"
        }
    }
}